---
id: upsert
title: "Upsert data: upsert()"
slug: /upsert
custom_edit_url: https://github.com/supabase/supabase/edit/master/spec/supabase_js_v2.yml
---

Perform an UPSERT on the table or view. Depending on the column(s) passed
to `onConflict`, `.upsert()` allows you to perform the equivalent of
`.insert()` if a row with the corresponding `onConflict` columns doesn't
exist, or if it does exist, perform an alternative action depending on
`ignoreDuplicates`.

By default, upserted rows are not returned. To return it, chain the call
with `.select()`.

```ts
const { data, error } = await supabase
  .from('countries')
  .upsert({ id: 1, name: 'Albania' })
  .select()
```


## Parameters


<ul className="method-list-group">
  
<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      values
    </span>
    <span className="method-list-item-label-badge required">
      required
    </span>
    <span className="method-list-item-validation">
      <code>Row</code> | <code>array</code>
    </span>
  </h4>
  <div class="method-list-item-description">

The values to upsert with. Pass an object to upsert a
single row or an array to upsert multiple rows.

  </div>
  
<ul className="method-list-group">
  <h5 class="method-list-title method-list-title-isChild expanded">Properties</h5>

<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      <code>object</code>
    </span>
    <span className="method-list-item-label-badge required">
      required
    </span>
    <span className="method-list-item-validation">
      <code>object</code>
    </span>
  </h4>
  <div class="method-list-item-description">

No description provided. 

  </div>
  
</li>


<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      Row
    </span>
    <span className="method-list-item-label-badge required">
      required
    </span>
    <span className="method-list-item-validation">
      <code>object</code>
    </span>
  </h4>
  <div class="method-list-item-description">

No description provided. 

  </div>
  
</li>

</ul>

</li>


<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      options
    </span>
    <span className="method-list-item-label-badge required">
      required
    </span>
    <span className="method-list-item-validation">
      <code>object</code>
    </span>
  </h4>
  <div class="method-list-item-description">

Named parameters

  </div>
  
<ul className="method-list-group">
  <h5 class="method-list-title method-list-title-isChild expanded">Properties</h5>

<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      count
    </span>
    <span className="method-list-item-label-badge false">
      optional
    </span>
    <span className="method-list-item-validation">
      <code>exact</code> | <code>planned</code> | <code>estimated</code>
    </span>
  </h4>
  <div class="method-list-item-description">

Count algorithm to use to count upserted rows.

`"exact"`: Exact but slow count algorithm. Performs a `COUNT(*)` under the
hood.

`"planned"`: Approximated but fast count algorithm. Uses the Postgres
statistics under the hood.

`"estimated"`: Uses exact count for low numbers and planned count for high
numbers.

  </div>
  
</li>


<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      ignoreDuplicates
    </span>
    <span className="method-list-item-label-badge false">
      optional
    </span>
    <span className="method-list-item-validation">
      <code>boolean</code>
    </span>
  </h4>
  <div class="method-list-item-description">

If `true`, duplicate rows are ignored. If
`false`, duplicate rows are merged with existing rows.

  </div>
  
</li>


<li className="method-list-item">
  <h4 className="method-list-item-label">
    <span className="method-list-item-label-name">
      onConflict
    </span>
    <span className="method-list-item-label-badge false">
      optional
    </span>
    <span className="method-list-item-validation">
      <code>string</code>
    </span>
  </h4>
  <div class="method-list-item-description">

Comma-separated UNIQUE column(s) to specify how
duplicate rows are determined. Two rows are duplicates if all the
`onConflict` columns are equal.

  </div>
  
</li>

</ul>

</li>

</ul>


## Notes

- Primary keys must be included in `values` to use upsert.










## Examples

### Upsert your data

<Tabs scrollable size="small" type="underlined" defaultActiveId="schema">
<TabPanel id="schema" label="Schema">

  ```sql
  create table
    countries (id int8 primary key, name text);

  insert into
    countries (id, name)
  values
    (1, 'Afghanistan');
  ```

</TabPanel>
<TabPanel id="js" label="JavaScript">

  ```ts
  const { data, error } = await supabase
    .from('countries')
    .upsert({ id: 1, name: 'Albania' })
    .select()
  ```

</TabPanel>
<TabPanel id="result" label="Result">

  ```json
  {
    "data": [
      {
        "id": 1,
        "name": "Albania"
      }
    ],
    "status": 201,
    "statusText": "Created"
  }
  ```

</TabPanel>
</Tabs>

### Bulk Upsert your data

<Tabs scrollable size="small" type="underlined" defaultActiveId="schema">
<TabPanel id="schema" label="Schema">

  ```sql
  create table
    countries (id int8 primary key, name text);

  insert into
    countries (id, name)
  values
    (1, 'Afghanistan');
  ```

</TabPanel>
<TabPanel id="js" label="JavaScript">

  ```ts
  const { data, error } = await supabase
    .from('countries')
    .upsert([
      { id: 1, name: 'Albania' },
      { id: 2, name: 'Algeria' },
    ])
    .select()
  ```

</TabPanel>
<TabPanel id="result" label="Result">

  ```json
  {
    "data": [
      {
        "id": 1,
        "name": "Albania"
      },
      {
        "id": 2,
        "name": "Algeria"
      }
    ],
    "status": 201,
    "statusText": "Created"
  }
  ```

</TabPanel>
</Tabs>

### Upserting into tables with constraints

In the following query, `upsert()` implicitly uses the `id`
(primary key) column to determine conflicts. If there is no existing
row with the same `id`, `upsert()` inserts a new row, which
will fail in this case as there is already a row with `handle` `"saoirse"`.

<Tabs scrollable size="small" type="underlined" defaultActiveId="schema">
<TabPanel id="schema" label="Schema">

  ```sql
  create table
    users (
      id int8 generated by default as identity primary key,
      handle text not null unique,
      display_name text
    );

  insert into
    users (id, handle, display_name)
  values
    (1, 'saoirse', null);
  ```

</TabPanel>
<TabPanel id="js" label="JavaScript">

  ```ts
  const { data, error } = await supabase
    .from('users')
    .upsert({ id: 42, handle: 'saoirse', display_name: 'Saoirse' })
    .select()
  ```

</TabPanel>
<TabPanel id="result" label="Result">

  ```json
  {
    "error": {
      "code": "23505",
      "details": "Key (handle)=(saoirse) already exists.",
      "hint": null,
      "message": "duplicate key value violates unique constraint \"users_handle_key\""
    },
    "status": 409,
    "statusText": "Conflict"
  }
  ```

</TabPanel>
</Tabs>

Using the `onConflict` option, you can instruct `upsert()` to use
another column with a unique constraint to determine conflicts:

<Tabs scrollable size="small" type="underlined" defaultActiveId="js">
<TabPanel id="js" label="JavaScript">

  ```ts
  await supabase
    .from('users')
    .upsert(
      { id: 42, handle: 'saoirse', display_name: 'Saoirse' },
      { onConflict: 'handle' },
    )
  const { data, error } = await supabase
    .from('users')
    .select()
  ```

</TabPanel>
<TabPanel id="result" label="Result">

  ```json
  {
    "data": [
      {
        "id": 42,
        "handle": "saoirse",
        "display_name": "Saoirse"
      }
    ],
    "status": 200,
    "statusText": "OK"
  }
  ```

</TabPanel>
</Tabs>